<!DOCTYPE html>
<html lang="en">
{% extends "layout.html" %}
{% block content %}
<!-- Begin page content -->
<main role="main" class="container">
    <h1 class="mt-5">Phage Genomes</h1>

    <!-- Rows per table selection -->
    <div class="mb-3 d-flex justify-content-between">
        <div>
            <label for="rowsPerTable">Rows per table:</label>
            <select id="rowsPerTable" class="form-select" style="width: auto;">
                <option value="10">10</option>
                <option value="50">50</option>
                <option value="100">100</option>
            </select>
        </div>
        <input type="text" id="searchInput" class="form-control" placeholder="Search genomes (e.g., 'Escherichia', '5000')" style="width: 50%;">
    </div>
    
    <!-- Table -->
    <table class="table table-bordered" id="genomesTable">
        <thead>
            <tr>
                <th><input type="checkbox" id="selectAll"></th> <!-- Master checkbox -->
                <th>Accession ID</th>
                <th>Species</th>
                <th>Genome Length</th>
                <th>Modification Date</th>
                <th>Fasta</th>
            </tr>
        </thead>
        <tbody>
            {% for genome in genomes %}
            <tr>
                <td><input type="checkbox" class="rowCheckbox"></td> <!-- Checkbox for each row -->
                <td>{{ genome[0] }}</td>
                <td>{{ genome[1] }}</td>
                <td>{{ genome[2] }}</td>
                <td>{{ genome[3] }}</td>
                <td><a href="https://www.ncbi.nlm.nih.gov/sviewer/viewer.cgi?db=nuccore&report=fasta&id={{ genome[0] }}" class="btn btn-primary" target="_blank" download="{{ genome[0] }}.fasta">Download FASTA</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <!-- Pagination Controls -->
    <nav aria-label="Table navigation">
        <ul class="pagination">
            <li class="page-item"><a class="page-link" href="#" id="prevPage">Previous</a></li>
            <!-- Pagination buttons will be dynamically inserted here -->
            <li class="page-item"><a class="page-link" href="#" id="nextPage">Next</a></li>
        </ul>
    </nav>
</main>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function(){
        // Existing search functionality
        $("#searchInput").on("keyup", function() {
            var value = $(this).val().toLowerCase();
            $("#genomesTable tbody tr").filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    
        let current_page = 1;
        let rows_per_table = parseInt($("#rowsPerTable").val());
        let sortOrderGlobal = 'asc'; // Global sort order state

        // Function to show rows for a specific page
        function showRowsForPage(page) {
            const start_index = (page - 1) * rows_per_table;
            const end_index = start_index + rows_per_table;
            $("#genomesTable tbody tr").hide().slice(start_index, end_index).show();
        }

        // Function to update the display based on the current page and rows per table
        function updateDisplay() {
            showRowsForPage(current_page);
            updatePagination();
        }

        // Function to handle the sorting of table rows
        function sortTableByColumn(columnIndex) {
            let rows = $("#genomesTable tbody tr").get();
            rows.sort(function(a, b) {
                let valA = $(a).children('td').eq(columnIndex).text().toLowerCase();
                let valB = $(b).children('td').eq(columnIndex).text().toLowerCase();

                if($.isNumeric(valA) && $.isNumeric(valB)) {
                    valA = parseFloat(valA); 
                    valB = parseFloat(valB);
                }

                if(sortOrderGlobal === 'asc') {
                    return valA > valB ? 1 : valA < valB ? -1 : 0;
                } else {
                    return valA < valB ? 1 : valA > valB ? -1 : 0;
                }
            });

            $.each(rows, function(index, row) {
                $("#genomesTable tbody").append(row);
            });

            // Toggle the global sort order for the next sort operation
            sortOrderGlobal = (sortOrderGlobal === 'asc') ? 'desc' : 'asc';
            updateDisplay(); // Update display after sorting
        }

        // Pagination control setup
        function updatePagination() {
            const numPages = Math.ceil($("#genomesTable tbody tr").length / rows_per_table);
            // Implement pagination button updates here if dynamic buttons are needed
        }

        // Rows per table selection change
        $("#rowsPerTable").change(function() {
            rows_per_table = parseInt($(this).val());
            current_page = 1;
            updateDisplay();
        });

        // Previous and Next page button handlers
        $("#prevPage").click(function(e) {
            e.preventDefault();
            if (current_page > 1) {
                current_page--;
                updateDisplay();
            }
        });

        $("#nextPage").click(function(e) {
            e.preventDefault();
            const numPages = Math.ceil($("#genomesTable tbody tr").length / rows_per_table);
            if (current_page < numPages) {
                current_page++;
                updateDisplay();
            }
        });

        // Column header click event for sorting
        $("#genomesTable th").click(function() {
            const columnIndex = $(this).index();
            sortTableByColumn(columnIndex);
        });

        // Initial display update
        updateDisplay();
        });
</script>

<!-- selection checkbox script-->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const selectAllCheckbox = document.getElementById('selectAll');
        const rowCheckboxes = document.querySelectorAll('.rowCheckbox');

        // When the master checkbox changes state, update all row checkboxes
        selectAllCheckbox.addEventListener('change', function() {
            rowCheckboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });

        // Update the master checkbox state based on the individual selections of row checkboxes
        rowCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                selectAllCheckbox.checked = rowCheckboxes.length === document.querySelectorAll('.rowCheckbox:checked').length;
            });
        });
    });
</script>


{% endblock %}

        