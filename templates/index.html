<!DOCTYPE html>
<html lang="en">
{% extends "layout.html" %}
{% block content %}
<!-- Begin page content -->
<main role="main" class="container">
    <h1 class="mt-5">Phage Genomes</h1>

    <!-- Row selection and Search form -->
    <div class="mb-3 d-flex justify-content-between">
        <div>
            <label for="rowsPerPage">Rows per page:</label>
            <select id="rowsPerPage" class="form-select" style="width: auto;">
                <option value="10">10</option>
                <option value="50">50</option>
                <option value="100">100</option>
            </select>
        </div>
        <input type="text" id="searchInput" class="form-control" placeholder="Search genomes (e.g., 'Escherichia', '5000')" style="width: 50%;">
    </div>
    
    <!-- Table goes here -->
    <table class="table table-bordered" id="genomesTable">
        <thead>
            <tr>
                <th data-column="accessionID" class="sortable">Accession ID <span class="sort-direction"></span></th>
                <th data-column="species" class="sortable">Species <span class="sort-direction"></span></th>
                <th data-column="genomeLength" class="sortable">Genome Length <span class="sort-direction"></span></th>
                <th data-column="modificationDate" class="sortable">Modification Date <span class="sort-direction"></span></th>
                <th>Fasta</th>
            </tr>
        </thead>
        <tbody>
            {% for genome in genomes %}
            <tr>
                <td>{{ genome[0] }}</td>
                <td>{{ genome[1] }}</td>
                <td>{{ genome[2] }}</td>
                <td>{{ genome[3] }}</td>
                <td>
                    <a href="https://www.ncbi.nlm.nih.gov/sviewer/viewer.cgi?db=nuccore&report=fasta&id={{ genome[0] }}" class="btn btn-primary" target="_blank" download="{{ genome[0] }}.fasta">Download FASTA</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function(){
        // Existing search functionality
        $("#searchInput").on("keyup", function() {
            var value = $(this).val().toLowerCase();
            $("#genomesTable tbody tr").filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    
        // Rows per page functionality
        $("#rowsPerPage").change(function() {
            var selectedValue = parseInt($(this).val());
    
            $("#genomesTable tbody tr").hide(); // Hide all rows
            $("#genomesTable tbody tr").slice(0, selectedValue).show(); // Show the number of rows based on the selection
        }).change(); // Trigger change to apply initially
    
        // Existing sorting functionality
        $('.sortable').on('click', function(){
            var columnIndex = $(this).index();
            var sortOrder = $(this).data('sortOrder') || 'asc'; // Default to ascending
    
            var rows = $("#genomesTable tbody tr:visible").toArray().sort(comparer(columnIndex, sortOrder));
    
            // Update the sortOrder data attribute
            $(this).data('sortOrder', sortOrder === 'asc' ? 'desc' : 'asc');
    
            $.each(rows, function(index, row) {
                $("#genomesTable tbody").append(row); // Re-append rows in sorted order
            });
    
            // Add or toggle the sort-direction indicator
            $('.sortable').find('.sort-direction').text(''); // Clear all indicators
            $(this).find('.sort-direction').text(sortOrder === 'asc' ? ' ▲' : ' ▼'); // Set the current column's indicator
        });
    
        function comparer(index, sortOrder) {
            return function(a, b) {
                var valA = getCellValue(a, index), valB = getCellValue(b, index);
                valA = $.isNumeric(valA) ? parseFloat(valA) : valA.toLowerCase();
                valB = $.isNumeric(valB) ? parseFloat(valB) : valB.toLowerCase();
    
                if(sortOrder === 'asc') {
                    return valA < valB ? -1 : valA > valB ? 1 : 0;
                } else {
                    return valA > valB ? -1 : valA < valB ? 1 : 0;
                }
            };
        }
    
        function getCellValue(row, index) { 
            return $(row).children('td').eq(index).text(); 
        }
    });
</script>

{% endblock %}

        